外部ファイルの取り込み時の動作について
外部ファイルの取り込み時の動作について
<h3>外部ファイルの更新確認</h3>
<br>
<div>Version 2.6.3 以降では外部ファイルを取り込んだ時の動作が少し変わりました。
</div>
<div>今までは単純に新規自作小説として取り込まれるだけでしたが、Version 2.6.3以降では取り込み時に使った元のファイルの更新確認を行うようになりました。
このため、本棚画面右上の更新確認ボタン(時計回りに回転しているぽい矢印のボタン)を押したりした時に、元ファイルの更新を確認できた場合には本棚内の小説の内容が更新されます。iCloud Drive 越しに共有されているファイルを用いている場合などで効果があるかもしれません。
(なお、Version 2.6.3 のリリース告知文やアプリ内の更新履歴などでは外部ファイル取り込み時に更新確認が行われる対象がテキストファイルのみのような記述がされていますが、こちらは実装途中の制約で、Version 2.6.3 リリース時には .txt, .pdf, .rtf, .html のそれぞれのファイルについても更新確認を行うようにしています)
</div>
<div>ただ、このファイルの更新確認については、更新確認が行えないパターンもある事が確認されています。具体的には Google Drive アプリ や Dropbox アプリ からの共有メニューをつかった取り込みでは、更新確認ができない場所にファイルをコピーした後に ことせかい に渡されるようで、ことせかい の側でのファイルの更新確認がうまく動作しないようでした(コピーされる前のファイルは更新されているけれど、コピーされたファイルは渡された後に消されてしまって更新されないので ことせかい の側からはファイルが消えたか更新されていないように見えてしまうという形)。
この時、Dropbox の場合などでは ファイルアプリ から見られる場所に Dropbox の共有ファイルが見える場所があり、そちらからの取り込みであればコピーされずに元ファイルを直接参照できるようです。そのため、Dropbox を使ったファイル共有では ファイルアプリ や ことせかい内 の「設定タブ」→「ファイルの取り込み」から取り込む形で運用していただけますと、おそらくは動作すると思います。
</div>
<div>また、ことせかい の側では iCloud Drive (や Dropbox など)のフォルダ内の情報更新は行っておりませんため、実際にファイルの更新が行われるのはそれらの ファイルアプリ を起動して該当のフォルダを開くなどをしておきませんとファイルの更新を検知できないと思われます。(更新が行われているかは「ファイルアプリ」や「設定タブ」→「ファイルの取り込み」で表示されるそれぞれのファイルの日付を確認していただけると多分それが正しいです。なお、「設定タブ」→「ファイルの取り込み」で開くダイアログで該当のフォルダを開く事でもおそらくはそのファイルのタイムスタンプが更新されると思います。けれども、結局は手動でそのフォルダを開く必要がありますので面倒なんですよね。アプリ側からUIを入れずにこれと同様の動作をすることができれば良いと思うのですが、今の所それをする方法を調べてもおりませんのでできたとしても未実装という形になっています。やり方をよく知っておられる方はこっそり教えていただけますと次回以降のアップデートでなんとかできるかもしれません)
</div>
<div>なお、この更新確認機能については Version 2.6.3 以降での外部ファイルの取り込みを行った小説についてのみ機能します。逆に言うと、Version 2.6.3 より前のバージョンで取り込まれた小説(外部ファイルから読み込まれた自作小説扱いの小説)については機能しません。また、この更新確認機能については iCloud 同期をしていた場合の他の端末で更新確認ができるようにはなりません。同様に、「設定タブ」→「バックアップ用データの作成」で生成されるバックアップデータにはこの更新確認用のデータは含まれませんので、バックアップデータから復元された(外部ファイルから読み込まれた自作小説扱いの)小説は、更新確認が行われませんので注意してください。</div>
<br>
<h3>更新設定の注意点</h3>
<br>
<div>この更新動作はWeb取込機能で取り込まれた物とは少し違っていて、その小説の本文が全て置き換わる形で更新の反映を行います。そのため、場合によっては問題が起こる可能性もあります。例えば、
<ul>
	<li>ことせかい の側でその小説を編集していた場合、その編集結果は破棄されて、元ファイルの(新しくなった)内容に上書きされます</li>
	<li>Web取込機能のように、新しいページだけが追加されるのではなく、全てのページが置き換わるため、以前から ことせかい 側に取り込まれていた部分も置き換わります</li>
	<li>上記2つの作用は同時？に起こるため、ことせかい の側で小説の前の方のページを書き換えており、元ファイルには新しいページが追加されただけだったとしても、ことせかい の側で編集されたその前の方のページの内容は破棄され、元ファイルに書かれていた内容(おそらくは ことせかい で編集する前の内容)に上書きされます</li>
</ul>
というような事が起こります。
</div>
<div>もし、そのような事が起こるのを回避したい場合には、「小説本文画面」右上の「詳細」ボタンから「小説の詳細・小説専用設定」画面に移動して、「この小説の更新確認を行わない」をONにしてください。これがONになっていれば、「本棚画面」や「設定タブ」→「小説の自動更新」からの更新確認は行われなくなります。(ただし、「小説の詳細・小説専用設定」画面での「この小説の更新確認を行う」は実行されますのでご注意ください)
</div>
<br>
<h3>「ことせかい へ読み込む」機能のUI変更</h3>
<br>
<div>話は変わりますが、Version 2.6.3 より前ではSafariで表示しているページを ことせかい に取り込む場合、シェアボタンを押して出てくるシェアメニューの中の「ことせかい へ読み込む」と書かれた灰色のアイコンの物をタップして読み込むようになっていました。しかし、Version 2.6.3 からはそのボタンは廃止され、カラーの「ことせかい」と書かれたボタンを使うようになりました。こちらのカラーのアイコンのものは、以前から存在はしていたのですが、Safari からのWebページのシェアには使えない(表示されない)状態になっていました(ファイルアプリなどでは表示されていたと思います)。つまり、「ことせかい へ読み込む」ボタン(灰色のアイコンのもの)と、「ことせかい」と書かれたカラーのアイコンの物の2つがあり、それぞれ提供する機能が違っているという状態でした。
</div>
<div>残念なことに、灰色のアイコンの物の方はSafariからのシェアメニューにしか使えないにも関わらず、利用できない場所でも表示されるという状態になていました。そのため、ファイルアプリ(などの Safari ではないアプリ)から ことせかい に取り込もうとして、こちらの灰色のアイコンのものを使おうとしてしまい、「使えないのか」と「理解」されてしまうという問題がありました。そのため、今回の修正では、こちらの「使えない場合のある灰色のアイコンの機能」は廃止とし、その代わりとして、カラーのアイコン側でもSafariからの取り込みをできるように実装いたしました。機能的にはほとんど変わりませんが、Safariでしか動作しないボタンが他のアプリからのシェアメニューにも出るという事をなくせるという目的は果たせている感じになっています。</div>
<div>
なお、Safariからの取り込みに利用するカラーのアイコンの物と、ファイルアプリなどから利用できていた(今までも利用できていた)カラーのアイコンの物は利用している iOS の機能が違っておりますので、少々動作が変わっています。これは、今まで利用できていたものは「ことせかい」と書かれたカラーのアイコンをタップした後すぐに ことせかい に切り替わりますが、新しく追加した方のカラーのアイコンの物では、「ことせかい で取り込む」と「キャンセル」という2つのボタンのダイアログが表示されて、「ことせかい で取り込む」を選択していただくと ことせかい に切り替わるという形になっています。こちらのダイアログが出る方の物と今までのダイアログが出ない物は別の機能として実装していますので、場合によってはそれぞれについて、『カラーのアイコンの列の「その他」を選ばないと選択肢として表示されない」場合があります。そのような場合は、『カラーのアイコンの列の「その他」を選んで出てきたダイアログで「編集」を選択して「ことせかい」の左側のプラスボタンを押して「よく使う項目」に入れておく』と良いかもしれません。
</div>
<br>
